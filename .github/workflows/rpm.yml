name: Release plugin RPM

on:
  workflow_dispatch:

jobs:
  rpm:
    runs-on: ubuntu-latest
    container: 
      image: ghcr.io/eth-cscs/slurm-container-20.11.9:latest
      credentials:
        username: ${{ github.ACTOR }}
        password: ${{ secrets.GITHUB_TOKEN }}


    steps:
    - uses: actions/checkout@v3
    - name: Build
      run: |
        apt-get update -y
        apt-get upgrade -y
        apt-get install lsb-release -y
        apt-get clean all
        lsb_release
        ls && pwd

#   - name:
#     run: zypper install -y rpm-build
#   - name: clone
#     uses: actions/checkout@v2
#   - name: build-srpm
#     run: |
#       make rpm
#       sudo rpmbuild --rebuild "$(find rpm/SRPMS -name '*.rpm' -type f -print -quit)" --define "_topdir $(pwd)/rpm"
#       sudo rpm --install "$(find rpm/RPMS -name '*.rpm' -type f -print -quit)"
#       find rpm -name '*.rpm' -type f -exec cp {} . \;
#   - name: upload-rpm        
#     uses: actions/upload-artifact@v3
#     with:
#       name: rpm
#       path: '*.rpm'

